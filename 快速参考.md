# NFCå®¶åº­ç‰©å“ç®¡ç†ç³»ç»Ÿ - å¿«é€Ÿå‚è€ƒ

## ğŸ”§ æœåŠ¡å™¨ä¿¡æ¯
```
æœåŠ¡å™¨IP: 101.35.16.205
æ“ä½œç³»ç»Ÿ: CentOS Stream 9
SSHç™»å½•: ssh root@101.35.16.205 (å¯†ç : Guo@112233)
```

## ğŸ—„ï¸ æ•°æ®åº“ä¿¡æ¯
```
MySQLå®¹å™¨: mysql_TXY
ç«¯å£: 13306
Rootå¯†ç : Gpw@112233
åº”ç”¨æ•°æ®åº“: nfc_home_manager
åº”ç”¨ç”¨æˆ·: nfc_user (å¯†ç : Nfc@112233)
```

## ğŸ“ ç›®å½•ç»“æ„
```
/opt/nfc-home-manager/          # åº”ç”¨æ ¹ç›®å½•
â”œâ”€â”€ server.js                   # ä¸»ç¨‹åºæ–‡ä»¶
â”œâ”€â”€ .env                        # ç¯å¢ƒé…ç½®
â”œâ”€â”€ package.json                # ä¾èµ–é…ç½®
â”œâ”€â”€ ecosystem.config.js         # PM2é…ç½®
â”œâ”€â”€ uploads/                    # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ logs/                       # åº”ç”¨æ—¥å¿—
â””â”€â”€ models/                     # æ•°æ®æ¨¡å‹
```

## âš¡ å¿«é€Ÿéƒ¨ç½²
```bash
# 1. ä¸‹è½½éƒ¨ç½²è„šæœ¬
wget https://your-domain.com/auto-deploy.sh

# 2. æ‰§è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²
chmod +x auto-deploy.sh
bash auto-deploy.sh
```

## ğŸ“‹ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### åº”ç”¨ç®¡ç†
```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
sudo -u nfc-app pm2 status

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
sudo -u nfc-app pm2 logs nfc-home-manager

# é‡å¯åº”ç”¨
sudo -u nfc-app pm2 restart nfc-home-manager

# åœæ­¢åº”ç”¨
sudo -u nfc-app pm2 stop nfc-home-manager

# åˆ é™¤åº”ç”¨è¿›ç¨‹
sudo -u nfc-app pm2 delete nfc-home-manager
```

### æ•°æ®åº“ç®¡ç†
```bash
# è¿æ¥æ•°æ®åº“
docker exec -it mysql_TXY mysql -unfc_user -pNfc@112233 nfc_home_manager

# æŸ¥çœ‹MySQLçŠ¶æ€
docker ps | grep mysql_TXY

# é‡å¯MySQL
docker restart mysql_TXY

# æŸ¥çœ‹MySQLæ—¥å¿—
docker logs mysql_TXY

# å¤‡ä»½æ•°æ®åº“
docker exec mysql_TXY mysqldump -uroot -pGpw@112233 nfc_home_manager > backup.sql

# è¿˜åŸæ•°æ®åº“
docker exec -i mysql_TXY mysql -uroot -pGpw@112233 nfc_home_manager < backup.sql
```

### Nginxç®¡ç†
```bash
# æŸ¥çœ‹NginxçŠ¶æ€
systemctl status nginx

# é‡å¯Nginx
systemctl restart nginx

# é‡æ–°åŠ è½½é…ç½®
systemctl reload nginx

# æµ‹è¯•é…ç½®æ–‡ä»¶
nginx -t

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/nfc-home-manager.access.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/nfc-home-manager.error.log
```

### ç³»ç»Ÿç›‘æ§
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ç©ºé—´
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp | grep -E "(3000|13306|80)"

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep -E "(node|nginx|mysql)"
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜æ£€æŸ¥æ¸…å•

**åº”ç”¨æ— æ³•è®¿é—®**
- [ ] æ£€æŸ¥é˜²ç«å¢™ç«¯å£æ˜¯å¦å¼€æ”¾
- [ ] æ£€æŸ¥Nginxæ˜¯å¦è¿è¡Œ: `systemctl status nginx`
- [ ] æ£€æŸ¥Node.jsåº”ç”¨æ˜¯å¦è¿è¡Œ: `sudo -u nfc-app pm2 status`
- [ ] æ£€æŸ¥åº”ç”¨ç«¯å£3000æ˜¯å¦ç›‘å¬: `netstat -tlnp | grep 3000`

**æ•°æ®åº“è¿æ¥å¤±è´¥**
- [ ] æ£€æŸ¥MySQLå®¹å™¨æ˜¯å¦è¿è¡Œ: `docker ps | grep mysql_TXY`
- [ ] æ£€æŸ¥ç«¯å£13306æ˜¯å¦å¼€æ”¾: `netstat -tlnp | grep 13306`
- [ ] æµ‹è¯•æ•°æ®åº“è¿æ¥: `docker exec mysql_TXY mysql -unfc_user -pNfc@112233 -e "SELECT 1;"`

**åº”ç”¨å¯åŠ¨å¤±è´¥**
- [ ] æŸ¥çœ‹åº”ç”¨æ—¥å¿—: `sudo -u nfc-app pm2 logs nfc-home-manager`
- [ ] æ£€æŸ¥.envé…ç½®æ–‡ä»¶: `cat /opt/nfc-home-manager/.env`
- [ ] æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…: `ls /opt/nfc-home-manager/node_modules`

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### ä»£ç æ›´æ–°æµç¨‹
```bash
# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
cd /opt/nfc-home-manager
tar -czf ../nfc-backup-$(date +%Y%m%d).tar.gz .

# 2. æ‹‰å–æœ€æ–°ä»£ç  (å¦‚æœä½¿ç”¨Git)
git pull origin main

# 3. å®‰è£…æ–°ä¾èµ–
sudo -u nfc-app npm install

# 4. é‡å¯åº”ç”¨
sudo -u nfc-app pm2 restart nfc-home-manager
```

### å›æ»šæ“ä½œ
```bash
# 1. åœæ­¢åº”ç”¨
sudo -u nfc-app pm2 stop nfc-home-manager

# 2. æ¢å¤å¤‡ä»½
cd /opt
tar -xzf nfc-backup-YYYYMMDD.tar.gz -C nfc-home-manager

# 3. å¯åŠ¨åº”ç”¨
sudo -u nfc-app pm2 start nfc-home-manager
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### PM2æ€§èƒ½è°ƒä¼˜
```bash
# ä¿®æ”¹ ecosystem.config.js
{
  instances: 2,              # å®ä¾‹æ•°é‡
  max_memory_restart: '1G',  # å†…å­˜é™åˆ¶
  min_uptime: '10s',         # æœ€å°è¿è¡Œæ—¶é—´
  max_restarts: 10           # æœ€å¤§é‡å¯æ¬¡æ•°
}
```

### Nginxç¼“å­˜ä¼˜åŒ–
```nginx
# åœ¨ /etc/nginx/conf.d/nfc-home-manager.conf ä¸­æ·»åŠ 
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

## ğŸ” å®‰å…¨æ£€æŸ¥

### å®šæœŸå®‰å…¨ä»»åŠ¡
- [ ] æ›´æ–°ç³»ç»ŸåŒ…: `yum update -y`
- [ ] æ£€æŸ¥é˜²ç«å¢™è§„åˆ™: `firewall-cmd --list-all`
- [ ] æŸ¥çœ‹ç™»å½•æ—¥å¿—: `tail -f /var/log/secure`
- [ ] æ£€æŸ¥å¼‚å¸¸è¿›ç¨‹: `ps aux | grep -v root`
- [ ] æ›´æ–°SSLè¯ä¹¦ (å¦‚æœä½¿ç”¨HTTPS)

### å¤‡ä»½éªŒè¯
- [ ] æµ‹è¯•æ•°æ®åº“å¤‡ä»½æ¢å¤
- [ ] éªŒè¯åº”ç”¨æ–‡ä»¶å¤‡ä»½å®Œæ•´æ€§
- [ ] æ£€æŸ¥å¤‡ä»½æ–‡ä»¶è‡ªåŠ¨æ¸…ç†

## ğŸ“ ç´§æ€¥è”ç³»

**é‡å¯æ‰€æœ‰æœåŠ¡**
```bash
#!/bin/bash
# ç´§æ€¥é‡å¯è„šæœ¬
systemctl restart firewalld
docker restart mysql_TXY
sudo -u nfc-app pm2 restart all
systemctl restart nginx
```

**å®Œå…¨é‡ç½®** (è°¨æ…ä½¿ç”¨)
```bash
#!/bin/bash
# é‡ç½®è„šæœ¬ - ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®
sudo -u nfc-app pm2 delete all
docker stop mysql_TXY && docker rm mysql_TXY
rm -rf /var/lib/mysql-data/*
# ç„¶åé‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬
```

---

**ğŸ“ è®°ä½**: 
- å®šæœŸå¤‡ä»½æ•°æ®åº“å’Œåº”ç”¨æ–‡ä»¶
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- åŠæ—¶æ›´æ–°ç³»ç»Ÿå’Œåº”ç”¨ä¾èµ–
- ä¿å­˜å¥½æ‰€æœ‰å¯†ç å’Œé…ç½®ä¿¡æ¯ 